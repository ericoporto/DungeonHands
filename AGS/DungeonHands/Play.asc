// new module script
Character * cHero;
Character * cMonster;
Character * cTable;
GUI * GUI_HeroHand;
GUI * GUI_MonsterHand;
GUIControl * InvWindow_Hero;
GUIControl * InvWindow_Monster;
int turn_counter;
bool turn_monster;
bool turn_hero;
int phase;
bool playerd_monster_this_turn;
bool playerd_hero_this_turn;


void loseAllInventory(Character * c_to_lose){
  int i;
  i=1;
  while(i < Game.InventoryItemCount){
    int k;
    k=0;
    while(k<c_to_lose.InventoryQuantity[i]){
      c_to_lose.LoseInventory(inventory[i]);
      k++;  
    }
  
    i++;
  }
}

void Play_zeroItems(){
  loseAllInventory(cInvOwner1);
  loseAllInventory(cInvOwner2);
  loseAllInventory(cInvOwner3);
}

void start_round(){
  playerd_monster_this_turn=false;
  playerd_hero_this_turn=false;
}
void resolve_table(){
  loseAllInventory(cInvOwner3);
}

Character * Play_Get_Char_Monster(){
  return cMonster;
}

Character * Play_Get_Char_Hero(){
  return cHero;
}

function playerMonster_DrawQuick(){
  cMonster.AddInventory(Cards_MC_CardToItem(Cards_drawCard_MC()));
}


function playerHero_DrawQuick(){
  cHero.AddInventory(Cards_HC_CardToItem(Cards_drawCard_HC()));
}


void setMonsterTurn(){
  turn_hero=false;
  GUI_HeroHand.Clickable = false;
  GUI_HeroHand.Transparency = 50;
  
  turn_monster=true;
  GUI_MonsterHand.Clickable = true;
  GUI_MonsterHand.Transparency = 0;
  
}

void setHeroTurn(){
  turn_monster=false;
  GUI_MonsterHand.Clickable = false;
  GUI_MonsterHand.Transparency = 50;
  
  turn_hero=true;
  GUI_HeroHand.Clickable = true;
  GUI_HeroHand.Transparency = 0;
  
}

void next_turn(){
  if(turn_counter%2==0){
    start_round();
    setMonsterTurn();
  } else {
    setHeroTurn();
  }
  turn_counter++;
}

void Play_next_turn(){
  next_turn();
}

void Play_End_Turn(){
  if(playerd_hero_this_turn && playerd_monster_this_turn){
    resolve_table();
  }
  Play_next_turn();
}

void Play_Hero_Played_Card(InventoryItem * invItm){
  int card = Cards_HC_ItemToCard(invItm);
  playerd_hero_this_turn=true;
  if(!Card_HC_isCardSpecial(card)){
    Play_End_Turn();
  }
  
  
}

void Play_Monster_Played_Card(InventoryItem * invItm){
  int card = Cards_MC_ItemToCard(invItm);
  playerd_monster_this_turn=true;
  if(!Card_MC_isCardSpecial(card)){
    Play_End_Turn();
  }
}

function Play_deckDraw_MC(){
  if(turn_monster){
    playerMonster_DrawQuick();
  }
}

function Play_deckDraw_HC(){
  if(turn_hero){
    playerHero_DrawQuick();
  }
  
}

void drawHands(){
  int n_cards;
  n_cards=7;
  while(n_cards>0){
    playerMonster_DrawQuick();
    n_cards--;
  }
  
  n_cards=7;
  while(n_cards>0){
    playerHero_DrawQuick();
    n_cards--;
  }
}

function Play_begin(){
  turn_counter=0;
  gDeckHero.Visible = true;
  gDeckMonster.Visible = true;
  Play_zeroItems();
  Cards_makeDecks();
  drawHands();
  next_turn();
}

function game_start(){
  cHero = cInvOwner1 ;
  cMonster = cInvOwner2 ;
  cTable = cInvOwner3;
  GUI_HeroHand=gItemExchange1;
  GUI_MonsterHand=gItemExchange2;
  InvWindow_Hero = InventoryWindow1;
  InvWindow_Monster = InventoryWindow2;
  Play_begin();  
}
